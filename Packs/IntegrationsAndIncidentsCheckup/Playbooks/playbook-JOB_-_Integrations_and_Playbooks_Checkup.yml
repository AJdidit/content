id: JOB - Integrations and Playbooks Checkup
version: -1
name: JOB - Integrations and Playbooks Checkup
description: You should run this playbook as a scheduled job.  The playbook will check
  the health of all enabled integrations and open incidents.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 814f2f15-e8a9-4162-8b7a-75842231adde
    type: start
    task:
      id: 814f2f15-e8a9-4162-8b7a-75842231adde
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 220,
          "y": -40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: b58016a6-9341-4abb-807d-1e78fa07ec68
    type: title
    task:
      id: b58016a6-9341-4abb-807d-1e78fa07ec68
      version: -1
      name: Run Health Check Scripts
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "15"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 220,
          "y": 160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "11":
    id: "11"
    taskid: 637b8ce2-998d-4a98-8241-b9212464d3a9
    type: title
    task:
      id: 637b8ce2-998d-4a98-8241-b9212464d3a9
      version: -1
      name: Create Lists for Dashboard
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 220,
          "y": 530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "12":
    id: "12"
    taskid: d6aad6e0-da66-4783-8ea4-aaf8c17814a7
    type: playbook
    task:
      id: d6aad6e0-da66-4783-8ea4-aaf8c17814a7
      version: -1
      name: JOB - Integrations and Playbooks Checkup - Lists handling
      playbookName: JOB - Integrations and Playbooks Checkup - Lists handling
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "20"
      - "28"
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 220,
          "y": 680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "15":
    id: "15"
    taskid: 81a2a9b4-2ba0-4519-87b9-031e4c51b5b7
    type: playbook
    task:
      id: 81a2a9b4-2ba0-4519-87b9-031e4c51b5b7
      version: -1
      name: JOB - Integrations and Playbooks Checkup - Running Scripts
      playbookName: JOB - Integrations and Playbooks Checkup - Running Scripts
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "11"
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 220,
          "y": 330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "16":
    id: "16"
    taskid: 87332e3c-3142-4d55-8863-8bd83f04bd85
    type: condition
    task:
      id: 87332e3c-3142-4d55-8863-8bd83f04bd85
      version: -1
      name: Should send the health check report?
      description: |
        Checks if there the input to send the health check report ("SendHealthCheckReport") equal 'True'.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "21"
      "yes":
      - "18"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.SendHealthCheckReport
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 220,
          "y": 1010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "17":
    id: "17"
    taskid: 047c13e5-1b2f-4d92-81e9-ce622b79201f
    type: regular
    task:
      id: 047c13e5-1b2f-4d92-81e9-ce622b79201f
      version: -1
      name: Generate Health Check report
      description: commands.local.cmd.generalReport
      script: Builtin|||generateGeneralReport
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      name:
        simple: Integrations and Incidents Health
      type: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 660,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "18":
    id: "18"
    taskid: fa64ddd2-f8c4-4867-85fe-e106ecceed04
    type: condition
    task:
      id: fa64ddd2-f8c4-4867-85fe-e106ecceed04
      version: -1
      name: Is there an email address to send the report?
      description: Checks if there is an input of the email address to send the report
        to.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "21"
      "yes":
      - "17"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.EmailReportTo
            iscontext: true
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "19":
    id: "19"
    taskid: 2f38b21f-c996-427b-8f93-249b6c5fc0c8
    type: regular
    task:
      id: 2f38b21f-c996-427b-8f93-249b6c5fc0c8
      version: -1
      name: Send Health Check report
      description: Sends the Health Check report.
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      attachCIDs: {}
      attachIDs:
        complex:
          root: InfoFile
          accessor: EntryID
      attachNames: {}
      bcc: {}
      body:
        simple: Please find attached Integrations and Incidents Health Check report
          for enabled integrations and open incidents.
      cc: {}
      htmlBody: {}
      replyTo: {}
      subject:
        simple: Integrations and Incidents Health Check Report
      to:
        complex:
          root: inputs.EmailReportTo
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 660,
          "y": 1510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "20":
    id: "20"
    taskid: 34fd3738-56e8-4aef-84b9-45356162adb7
    type: title
    task:
      id: 34fd3738-56e8-4aef-84b9-45356162adb7
      version: -1
      name: Send Health Check Report
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "16"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 220,
          "y": 870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "21":
    id: "21"
    taskid: 3fa7c4dc-4c43-491a-8222-5bfe8c1acb0b
    type: title
    task:
      id: 3fa7c4dc-4c43-491a-8222-5bfe8c1acb0b
      version: -1
      name: Re-RunTests
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "22"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 220,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "22":
    id: "22"
    taskid: 4e25c5f2-fd48-4a44-8481-b82d29251056
    type: condition
    task:
      id: 4e25c5f2-fd48-4a44-8481-b82d29251056
      version: -1
      name: Re run health check tests?
      description: Asks the user to re run the health check tests.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "25"
      "Yes":
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 220,
          "y": 1830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "24":
    id: "24"
    taskid: cd4df84a-a673-44ad-8044-95cec11f3fc5
    type: regular
    task:
      id: cd4df84a-a673-44ad-8044-95cec11f3fc5
      version: -1
      name: Delete context data
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 620,
          "y": 2000
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "25":
    id: "25"
    taskid: 271115df-9b10-40a2-806f-ac34bb5ed107
    type: title
    task:
      id: 271115df-9b10-40a2-806f-ac34bb5ed107
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 220,
          "y": 2510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: 9cfc6261-df5e-4d50-8c78-3312d389903d
    type: playbook
    task:
      id: 9cfc6261-df5e-4d50-8c78-3312d389903d
      version: -1
      name: JOB - Integrations and Playbooks Checkup - Lists handling
      description: This playbook is triggered by a 'JOB - Integrations and Playbooks
        Health' playbook and is responsible for creating nor updating related XSOAR
        lists.
      playbookName: JOB - Integrations and Playbooks Checkup - Lists handling
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 620,
          "y": 2340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: 8aa4fb35-8c7d-44d8-8245-588952b30b27
    type: playbook
    task:
      id: 8aa4fb35-8c7d-44d8-8245-588952b30b27
      version: -1
      name: JOB - Integrations and Playbooks Checkup - Running Scripts
      description: This playbook is triggered by a 'JOB - Integrations and Playbooks
        Health' playbook and is responsible for running failed integrations and failed
        incidents scripts.
      playbookName: JOB - Integrations and Playbooks Checkup - Running Scripts
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 620,
          "y": 2170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "28":
    id: "28"
    taskid: ba84ed65-4370-4285-88b4-53047109ead0
    type: title
    task:
      id: ba84ed65-4370-4285-88b4-53047109ead0
      version: -1
      name: Find open Health Check incidents
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "29"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -310,
          "y": 870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "29":
    id: "29"
    taskid: dbe39511-f791-4db6-8b5c-7ddc21b593be
    type: playbook
    task:
      id: dbe39511-f791-4db6-8b5c-7ddc21b593be
      version: -1
      name: Dedup - Generic v2
      description: This playbook identifies duplicate incidents using one of the supported
        methods.
      playbookName: Dedup - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      CloseAsDuplicate:
        simple: "false"
      DuplicateMethod:
        simple: rules
      DuplicateThreshold:
        simple: "0.9"
      IgnoreCloseIncidents:
        simple: "yes"
      MaxNumberOfCandidates:
        simple: "1000"
      TimeField:
        simple: created
      TimeFrameHours:
        simple: "72"
      similarIncidentFields:
        simple: type
      similarLabelsKeys: {}
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -310,
          "y": 1010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: 456f23a4-c2e2-40cc-8eaa-993b8764609e
    type: regular
    task:
      id: 456f23a4-c2e2-40cc-8eaa-993b8764609e
      version: -1
      name: Set linked incident to incident data
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      accountid: {}
      accountinformationbreached: {}
      accountname: {}
      addLabels: {}
      addcctoemail: {}
      affecteddata: {}
      affecteddatatype: {}
      affectedindividualscontactinformation: {}
      agentid: {}
      app: {}
      appendMultiSelect: {}
      approximatenumberofaffecteddatasubjects: {}
      assetid: {}
      assignmentgroup: {}
      attachmentcount: {}
      attachmentextension: {}
      attachmenthash: {}
      attachmentid: {}
      attachmentname: {}
      attachmentsize: {}
      attachmenttype: {}
      attorneygeneralnotification: {}
      blockedaction: {}
      breachconfirmation: {}
      bugtraq: {}
      caller: {}
      city: {}
      closeNotes: {}
      closeReason: {}
      cloudservice: {}
      commandline: {}
      companyaddress: {}
      companycity: {}
      companycountry: {}
      companyhasinsuranceforthebreach: {}
      companyname: {}
      companypostalcode: {}
      consumerreportingagenciesnotification: {}
      contactaddress: {}
      contactemailaddress: {}
      contactname: {}
      contacttelephonenumber: {}
      country: {}
      countrywherebusinesshasitsmainestablishment: {}
      countrywherethebreachtookplace: {}
      createddatefailedincidents: {}
      criticalassets: {}
      customFields: {}
      cve: {}
      cvss: {}
      dataencryptionstatus: {}
      datetimeofthebreach: {}
      dbotMirrorDirection: {}
      dbotMirrorId: {}
      dbotMirrorInstance: {}
      dbotMirrorTags: {}
      dbotprediction: {}
      dbotpredictionprobability: {}
      dbottextsuggestionhighlighted: {}
      deleteEmptyField: {}
      dest: {}
      desthostname: {}
      destinationhostname: {}
      destinationip: {}
      destinationnetwork: {}
      destinationport: {}
      destntdomain: {}
      destos: {}
      details: {}
      detectedexternalhosts: {}
      detectedexternalips: {}
      detectedinternalhosts: {}
      detectedinternalips: {}
      detectedusers: {}
      detectionendtime: {}
      detectionid: {}
      detectionupdatetime: {}
      detectionurl: {}
      devicehash: {}
      devicename: {}
      dpoemailaddress: {}
      dponotification: {}
      duration: {}
      emailaddress: {}
      emailauthenticitycheck: {}
      emailbcc: {}
      emailbody: {}
      emailbodyformat: {}
      emailbodyhtml: {}
      emailcc: {}
      emailclassification: {}
      emailclientname: {}
      emailfrom: {}
      emailheaders: {}
      emailhtml: {}
      emailinreplyto: {}
      emailkeywords: {}
      emailmessageid: {}
      emailreceived: {}
      emailreplyto: {}
      emailreturnpath: {}
      emailsenderip: {}
      emailsize: {}
      emailsource: {}
      emailsubject: {}
      emailto: {}
      emailtocount: {}
      emailurlclicked: {}
      employeedisplayname: {}
      employeeemail: {}
      employeemanageremail: {}
      escalation: {}
      eventid: {}
      eventtype: {}
      externaladdresses: {}
      failedincidentscreateddate: {}
      filehash: {}
      filename: {}
      filepath: {}
      filesize: {}
      financialinformationbreached: {}
      firstname: {}
      firstseen: {}
      healthinsurancebreached: {}
      helloworldid: {}
      helloworldstatus: {}
      helloworldtype: {}
      hostname: {}
      id: {}
      individualsnotification: {}
      infectedhosts: {}
      integrationscategories: {}
      integrationsfailedcategories: {}
      integrationstestgrid: {}
      internaladdresses: {}
      investigationstage: {}
      isolated: {}
      isthedatasubjecttodpia: {}
      labels: {}
      lastmodifiedby: {}
      lastmodifiedon: {}
      lastname: {}
      lastseen: {}
      likelyimpact: {}
      logsource: {}
      macaddress: {}
      maliciousbehavior: {}
      maliciouscauseifthecauseisamaliciousattack: {}
      malwarefamily: {}
      managementnotification: {}
      measurestomitigate: {}
      medianotification: {}
      medicalinformationbreached: {}
      mobiledevicemodel: {}
      moshe: {}
      name: {}
      numberofentriesiderrors: {}
      numberoffailedincidents: {}
      occurred: {}
      os: {}
      osversion: {}
      otherpiidatabreached: {}
      owner: {}
      parentprocessid: {}
      pcapencryptionkey: {}
      pcapendtime: {}
      pcapfile: {}
      pcapfilename: {}
      pcapfilesize: {}
      pcapflows: {}
      pcapnumberofpackets: {}
      pcapnumberofstreams: {}
      pcapstarttime: {}
      phase: {}
      phishingsubtype: {}
      phonenumber: {}
      pid: {}
      piidatatype: {}
      playbooknameswithfailedtasks: {}
      playbooksfailedcommands: {}
      playbookswithfailedtasks: {}
      playbooktaskserrors: {}
      policydeleted: {}
      policydescription: {}
      policydetails: {}
      policyid: {}
      policyrecommendation: {}
      policyremediable: {}
      policyseverity: {}
      policytype: {}
      possiblecauseofthebreach: {}
      postalcode: {}
      protocol: {}
      protocols: {}
      quarantined: {}
      rating: {}
      region: {}
      regionid: {}
      replacePlaybook: {}
      reporteremailaddress: {}
      residentnotificationoption: {}
      residentsemailaddress: {}
      resourceid: {}
      resourcename: {}
      resourcetype: {}
      riskrating: {}
      riskscore: {}
      roles: {}
      samaccountname: {}
      secretarynotification: {}
      sectorofaffectedparty: {}
      servicenowassignedto: {}
      servicenowassignmentgroup: {}
      servicenowcaller: {}
      servicenowcallerid: {}
      servicenowcategory: {}
      servicenowclosedby: {}
      servicenowcloseddate: {}
      servicenowdescription: {}
      servicenowduedate: {}
      servicenowescalation: {}
      servicenowimpact: {}
      servicenownotify: {}
      servicenowopeneddate: {}
      servicenowpriority: {}
      servicenowresolutioncode: {}
      servicenowresolutionnotes: {}
      servicenowresolvedtime: {}
      servicenowseverity: {}
      servicenowstate: {}
      servicenowticketnumber: {}
      servicenowurgency: {}
      servicetest: {}
      severity: {}
      signature: {}
      similarincident:
        complex:
          root: similarIncident
          accessor: rawId
      sizenumberofemployees: {}
      sizeturnover: {}
      skuname: {}
      skutier: {}
      sla: {}
      slaField: {}
      sourcehostname: {}
      sourceip: {}
      sourcenetwork: {}
      sourceport: {}
      sourceusername: {}
      src: {}
      srchostname: {}
      srcntdomain: {}
      srcos: {}
      srcuser: {}
      state: {}
      statecisonotification: {}
      statewherethebreachtookplace: {}
      subcategory: {}
      subtype: {}
      systems: {}
      telephoneno: {}
      tenantname: {}
      terminatedaction: {}
      threatactor: {}
      ticketcloseddate: {}
      ticketnumber: {}
      ticketopeneddate: {}
      totalfailedinstances: {}
      totalgoodinstances: {}
      totalinstances: {}
      triggeredsecurityprofile: {}
      type: {}
      unassignedincidents: {}
      uniquebiometricdatabreached: {}
      uniqueidentificationnumberbreached: {}
      uniqueports: {}
      urlsslverification: {}
      user: {}
      useraccountcontrol: {}
      username: {}
      vendorid: {}
      vendorproduct: {}
      vulnerabilitycategory: {}
      whereisdatahosted: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -310,
          "y": 1160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: 73ced6d8-0f12-4eef-8909-b0b2da270545
    type: regular
    task:
      id: 73ced6d8-0f12-4eef-8909-b0b2da270545
      version: -1
      name: Close linked incident
      description: Closes linked incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      assetid: {}
      closeNotes: {}
      closeReason: {}
      emailclassification: {}
      id:
        complex:
          root: similarIncident
          accessor: rawId
      phishingsubtype: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -310,
          "y": 1510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "32":
    id: "32"
    taskid: 5e8e07e5-4c0e-4365-8e3b-c564d0eab21c
    type: regular
    task:
      id: 5e8e07e5-4c0e-4365-8e3b-c564d0eab21c
      version: -1
      name: Copies analyst notes from linked incident
      description: Copies analyst notes from linked incident
      scriptName: CopyLinkedAnalystNotes
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -310,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "16_18_yes": 0.43,
      "16_21_#default#": 0.16,
      "18_17_yes": 0.47,
      "18_21_#default#": 0.18,
      "22_24_Yes": 0.33,
      "22_25_#default#": 0.19
    },
    "paper": {
      "dimensions": {
        "height": 2615,
        "width": 1350,
        "x": -310,
        "y": -40
      }
    }
  }
inputs:
- key: SendHealthCheckReport
  value: {}
  required: false
  description: |-
    This input determines if the health check report should be sent automatically after running the playbook.
    True - Yes.
  playbookInputQuery:
- key: EmailReportTo
  value: {}
  required: false
  description: In case the 'SendHealthCheckReport' input equals to 'True', the email
    address the report will be sent to.
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.0.0
